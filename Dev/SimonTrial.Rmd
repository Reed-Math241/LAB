---
title: "stock trial"
author: "Sung Bum Ahn"
date: "4/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(shiny)
library(readr)
library(stringr)
require(quantmod)
library(lubridate)
library(anytime)
```

```{r}
nyse_tickers <- read_csv("data-prep/nyse_tickers.csv")
wsb_dd_submissions <- read_csv("../WSB-viz/www/wsb_dd_submissions.csv")
View(wsb_dd_submissions)
```

```{r}
nyse_select <- data.frame(str_subset(nyse_tickers$Name, " Common Stock"))

nyse_common <- nyse_tickers %>% 
  inner_join(nyse_select, by = c("Name"="str_subset.nyse_tickers.Name....Common.Stock.."))

nyse_common <- nyse_common %>% 
  mutate(Name = str_replace(Name, " Common Stock", ""))
  
```



```{r}
getQuote("GME;AMC", what=yahooQF("Last Trade (Price Only)"))
```


```{r}
wsb_dd_submissions <- wsb_dd_submissions %>% 
    mutate(ticker=strsplit(title_stocks, " ")) %>% 
    unnest(ticker) %>% 
    drop_na(ticker)
```

```{r}
wsb_dd_submissions <- wsb_dd_submissions %>% 
  mutate(date = anydate(created_utc))
```

```{r}
count_ticker <- wsb_dd_submissions %>% 
  drop_na() %>% 
  group_by(date) %>%
  count(ticker)
```

```{r}
top_10 <- count_ticker %>%
  filter(date >= as.Date("2021-01-01") & date <= as.Date("2021-01-07")) %>%
  group_by(ticker) %>%
  summarise(count = sum(n)) %>%
  arrange(desc(count)) %>%
  slice(1:10)
ggplot(data = top_10, aes(x = ticker, y = count)) +
  geom_col()
```
Page 2

Data Preparation for page 2
```{r}
userSelectDate2 <- wsb_dd_submissions %>%
  filter(date >= as.Date("2021-01-01") & date <= as.Date("2021-01-05")) %>%
  filter(post_sentiment != 0)
```

```{r}
sentiment <- userSelectDate2 %>%
  group_by(ticker) %>%
  summarise(sentiment = sum(post_sentiment))

mentionedTimes <- userSelectDate2 %>%
  group_by(date) %>%
  count(ticker) %>% 
  group_by(ticker) %>%
  summarise(count = sum(n))

kmeanData <- merge(sentiment, mentionedTimes, by = "ticker")
```

Plot for page 2
```{r}
ggplot(data = kmeanData, aes(x = sentiment, y = count, color = ticker, size = count)) +
  geom_point()
```



