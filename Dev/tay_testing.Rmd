---
title: "Taylor Testing"
author: "Taylor Blair"
date: "5/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries


```{r cars}
library(tidyverse)

```

# Loading data

```{r pressure, echo=FALSE}
wsb_dd_submissions <- read_csv("Data/wsb_dd_submissions.csv")
merged_common <- read_csv("Dev/data-prep/merged_common.csv")

```

```{r}


count_and_sent <- function(df){
  
  sentiment_of_stock <- function(ticker){
    filtered_rows <- df%>%
      filter(grepl(paste("\\b", ticker, "\\b"), title_stocks))
    return(mean(filtered_rows$title_sentiment))
  }
  
stocks <- df$title_stocks[!is.na(df$title_stocks)]
stocks <- paste(stocks, sep = " ")
stocks <- as.list(unlist(strsplit(stocks, '[[:space:]]')))
stocks <- unlist(stocks)
stocks <- stocks[-(0:30)]

grouped <- tibble("stock" = stocks) %>%
  group_by(stock) %>%
  summarise(mentions=n())

grouped$sentiment <- unlist(map(grouped$stock, sentiment_of_stock))
grouped$sentiment[is.nan(grouped$sentiment)] <- 0 

return(grouped)
}

test <- count_and_sent(wsb_dd_submissions)



```

```{r}
library(openair)
library(lubridate)

wsb_dd_submissions <- read_csv("Data/wsb_dd_submissions.csv")


wsb_dd_submissions %>%
  mutate(created_utc = as.POSIXct(strptime(created_utc, format="%s")),
         created_utc = floor_date(created_utc, unit="day")) %>%
  group_by(created_utc) %>%
  summarise(posts = n()) %>%
  rename(date=created_utc) %>%
  calendarPlot(main = "Posts per day",
               pollutant = "posts")


```

